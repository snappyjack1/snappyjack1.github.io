---
layout: post
title: CVE-2018-16370 
excerpt: "PECSM-TEAM 2.2.2 has a file upload vulnerability"
categories: [code-review]
comments: true
---
In PESCMS Team 2.2.1, attackers may upload and execute arbitrary PHP code through /Public/?g=Team&m=Setting&a=upgrade by placing a .php file in a ZIP archive.More details see (https://github.com/lazyphp/PESCMS-TEAM/issues/2)

---

This page let user upgrade the PESCMS system manually.

![Image text](https://raw.githubusercontent.com/snappyJack/snappyjack.github.io/master/img/CVE-2018-16370(1).png)

Follow the mtUpgrade funtction,the upload file extension must be “zip”

![Image text](https://raw.githubusercontent.com/snappyJack/snappyjack.github.io/master/img/CVE-2018-16370(2).png)

and follow the unzip function

![Image text](https://raw.githubusercontent.com/snappyJack/snappyjack.github.io/master/img/CVE-2018-16370(3).png)

Follow the simulateInstall function and install function,we can see the file decompression in root directory

![Image text](https://raw.githubusercontent.com/snappyJack/snappyjack.github.io/master/img/CVE-2018-16370(4).png)

![Image text](https://raw.githubusercontent.com/snappyJack/snappyjack.github.io/master/img/CVE-2018-16370(5).png)

so,we can create a evil.php

![Image text](https://raw.githubusercontent.com/snappyJack/snappyjack.github.io/master/img/CVE-2018-16370(6).png)

and compression it as evil.zip,and upload the evil.zip,

![Image text](https://raw.githubusercontent.com/snappyJack/snappyjack.github.io/master/img/CVE-2018-16370(7).png)

at last ,the system decompress evil.zip and evil.php in root directory.

![Image text](https://raw.githubusercontent.com/snappyJack/snappyjack.github.io/master/img/CVE-2018-16370(8).png)
